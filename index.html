<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="PartiPay ‚Äì App de compartir gastos" />
    <title>PartiPay (1 archivo)</title>
    <style>
      :root { --gap: 12px; --radius: 12px; --border: #e5e7eb; --muted:#6b7280; }
      body{font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial,"Apple Color Emoji","Segoe UI Emoji";margin:0;background:#fafafa;color:#111}
      .container{max-width: 960px; margin: 24px auto; padding: 0 16px;}
      h1{font-size:28px;margin:0 0 8px}
      .muted{color:var(--muted)}
      .grid{display:grid; gap: var(--gap)}
      .grid-2{grid-template-columns: repeat(2, minmax(0,1fr))}
      @media (max-width: 860px){ .grid-2{grid-template-columns: 1fr} }
      .card{background:#fff;border:1px solid var(--border);border-radius:var(--radius)}
      .card-h{padding:16px 16px 0}
      .card-c{padding:16px}
      .row{display:flex; gap:var(--gap); align-items:center; flex-wrap:wrap}
      input, select, textarea, button{font:inherit}
      input, select, textarea{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:10px;background:#fff}
      table{width:100%;border-collapse:collapse}
      th, td{padding:8px 10px;border-bottom:1px solid #eee;text-align:left}
      .right{text-align:right}
      .btn{padding:10px 12px;border:1px solid var(--border);background:#fff;border-radius:10px;cursor:pointer}
      .btn.primary{background:#111;color:#fff;border-color:#111}
      .btn.danger{border-color:#ef4444;color:#ef4444}
      .bad{color:#b91c1c}
      .good{color:#065f46}
      .chips{display:flex; gap:6px; flex-wrap:wrap}
      .chip{border:1px solid var(--border);padding:6px 8px;border-radius:999px}
      .small{font-size:12px}

      /* Modal accesible y scrollable */
      .overlay{
        position:fixed; inset:0; background:rgba(0,0,0,.5);
        display:flex; justify-content:center; align-items:flex-start;
        padding:24px 12px; z-index:10; overflow:auto;
      }
      .modal{
        max-width:720px; width:100%;
        background:#fff; border:1px solid var(--border); border-radius:var(--radius);
        display:flex; flex-direction:column;
        max-height:90vh;
      }
      .modal-header{
        padding:12px 16px; border-bottom:1px solid var(--border);
        display:flex; align-items:center; justify-content:space-between; gap:12px;
      }
      .modal-title{font-size:18px; margin:0}
      .modal-body{ padding:16px; overflow:auto; }
      .modal-footer{
        padding:12px 16px; border-top:1px solid var(--border);
        display:flex; gap:12px; justify-content:flex-end; background:#fff;
      }
      .grid-2-narrow{display:grid; gap:var(--gap); grid-template-columns: repeat(2, minmax(0,1fr));}
      @media (max-width: 700px){ .grid-2-narrow{grid-template-columns: 1fr;} }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
      const { useState, useMemo, useEffect } = React;

      // ---------- Storage helpers
      const LAST_KEY = "partipay:last";
      const eventKey = (id) => `partipay:${id}`;

      const saveEvent = (ev) => {
        const key = eventKey(ev.id);
        localStorage.setItem(key, JSON.stringify(ev));
        localStorage.setItem(LAST_KEY, key);
      };
      const loadLastEvent = () => {
        const last = localStorage.getItem(LAST_KEY);
        if(!last) return null;
        const raw = localStorage.getItem(last);
        if(!raw) return null;
        try { return JSON.parse(raw); } catch { return null; }
      };
      const deleteEventFromStorage = (id) => {
        try { localStorage.removeItem(eventKey(id)); } catch {}
        try {
          const last = localStorage.getItem(LAST_KEY);
          if(last === eventKey(id)) localStorage.removeItem(LAST_KEY);
        } catch {}
      };

      // ---------- Utils
      const currencies = ["EUR","USD","GBP","MXN","COP","ARS","CLP","PEN"];
      const uid = (p="id") => `${p}_${Math.random().toString(36).slice(2,10)}`;
      const todayISO = () => new Date().toISOString().slice(0,10);
      const slugify = s => s.toLowerCase().trim().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");
      function fmt(amount, currency){
        try { return new Intl.NumberFormat(undefined, {style:"currency", currency}).format(amount); }
        catch { return amount.toFixed(2)+" "+currency; }
      }
      function download(filename, content, mime="application/json"){
        const a = document.createElement("a");
        a.href = URL.createObjectURL(new Blob([content], {type: mime}));
        a.download = filename;
        document.body.appendChild(a); a.click(); a.remove();
      }

      // ---------- C√°lculos
      function computeBalances(event){
        const map = {}; event.participants.forEach(p => map[p.id] = 0);
        for(const e of event.expenses){
          const involved = e.participantIds.length>0 ? e.participantIds : event.participants.map(p=>p.id);
          const total = (e.amount||0) + (e.tipAmount||0);
          const share = total / involved.length;
          if(e.payerMode === "multi" && e.payerSplits?.length){
            for(const s of e.payerSplits){ map[s.payerId] = (map[s.payerId]||0) + s.amount; }
          } else if(e.payerId){
            map[e.payerId] = (map[e.payerId]||0) + (e.amount||0);
          }
          if(e.tipAmount && e.tipAmount>0 && e.tipPayerId){
            map[e.tipPayerId] = (map[e.tipPayerId]||0) + e.tipAmount;
          }
          for(const pid of involved){ map[pid] = (map[pid]||0) - share; }
        }
        Object.keys(map).forEach(k => map[k] = Math.round(map[k]*100)/100);
        return map;
      }
      function settleDebts(balances){
        const debtors = [], creditors = [];
        Object.entries(balances).forEach(([id, amt])=>{
          if(amt < -0.009) debtors.push({id, amount:-amt});
          else if(amt > 0.009) creditors.push({id, amount:amt});
        });
        debtors.sort((a,b)=>b.amount-a.amount);
        creditors.sort((a,b)=>b.amount-a.amount);
        const txs = []; let i=0,j=0;
        while(i<debtors.length && j<creditors.length){
          const d=debtors[i], c=creditors[j];
          const pay = Math.min(d.amount, c.amount);
          txs.push({ from:d.id, to:c.id, amount: Math.round(pay*100)/100 });
          d.amount -= pay; c.amount -= pay;
          if(d.amount <= 0.009) i++; if(c.amount <= 0.009) j++;
        }
        return txs;
      }

      // ---------- App
      function App(){
        const [step, setStep] = useState("setup");
        const [eventName, setEventName] = useState("");
        const [currency, setCurrency] = useState("EUR");
        const [numParticipants, setNumParticipants] = useState(2);
        const [participantsDraft, setParticipantsDraft] = useState([]);
        const [event, setEvent] = useState(null);
        const [openExpense, setOpenExpense] = useState(false);

        // Carga inicial (persistencia)
        useEffect(()=>{
          const loaded = loadLastEvent();
          if(loaded){
            setEvent(loaded);
            setStep("event");
            setEventName(loaded.name || "");
            setCurrency(loaded.currency || "EUR");
          }
        },[]);

        // Persistencia autom√°tica
        useEffect(()=>{
          if(event) saveEvent(event);
        }, [event]);

        const balances = useMemo(()=> event ? computeBalances(event) : {}, [event]);
        const settlements = useMemo(()=> event ? settleDebts(balances) : [], [event, balances]);

        const handleSetupNext = () => {
          const n = Math.max(1, Math.min(20, parseInt(numParticipants||1,10)));
          setParticipantsDraft(Array.from({length:n}, (_,i)=>`P${i+1}`));
          setStep("participants");
        };
        const handleCreateEvent = () => {
          const cleanNames = participantsDraft.map(s=>s.trim()).filter(Boolean);
          if(!eventName.trim()) return alert("Ponle nombre al evento ‚úçÔ∏è");
          if(cleanNames.length < 1) return alert("Necesitas al menos 1 participante");
          const parts = cleanNames.map((name, idx)=> ({ id: uid(`p${idx+1}`), name }));
          const id = slugify(eventName) || `evento-${Date.now()}`;
          const ev = { id, name: eventName.trim(), currency, participants: parts, expenses: [], createdAt: new Date().toISOString() };
          setEvent(ev); setStep("event");
        };

        // RESET: borra el evento completo (localStorage + estado) con confirmaci√≥n
        const hardReset = () => {
          if(!event) return;
          if(confirm("¬øSeguro que quieres borrar todo el evento? Esta acci√≥n no se puede deshacer.")){
            deleteEventFromStorage(event.id);
            setEvent(null);
            setStep("setup");
            setEventName("");
            setCurrency("EUR");
            setNumParticipants(2);
            setParticipantsDraft([]);
          }
        };

        const exportJSON = () => {
          if(!event) return;
          download(`${event.id}.json`, JSON.stringify(event, null, 2));
        };
        const exportCSV = () => {
          if(!event) return;
          const rows = [
            ["date","description","payerMode","payer","payerSplits","amount","tipAmount","tipPayer","participants"],
            ...event.expenses.map(e=>{
              const payerName = e.payerId ? (event.participants.find(p=>p.id===e.payerId)?.name || "") : "";
              const splits = (e.payerSplits||[]).map(s=>{
                const n = event.participants.find(p=>p.id===s.payerId)?.name || "";
                return n+":"+s.amount.toFixed(2);
              }).join("|");
              const tipPayer = e.tipPayerId ? (event.participants.find(p=>p.id===e.tipPayerId)?.name || "") : "";
              const participantsNames = e.participantIds.map(pid=>event.participants.find(p=>p.id===pid)?.name).join("|");
              const safeDesc = '"' + (e.description||"").replace(/"/g,'""') + '"';
              return [ e.date, safeDesc, e.payerMode, payerName, splits, e.amount.toFixed(2), (e.tipAmount||0).toFixed(2), tipPayer, participantsNames ];
            })
          ];
          const csv = rows.map(r=>r.join(",")).join("\n");
          download(event.id + ".csv", csv, "text/csv");
        };
        const importJSON = (file) => {
          const reader = new FileReader();
          reader.onload = () => {
            try{
              const data = JSON.parse(String(reader.result));
              if(!data || !data.participants || !data.expenses) throw new Error("Formato no v√°lido");
              setEvent(data); setStep("event");
              setEventName(data.name || ""); setCurrency(data.currency || "EUR");
            }catch(err){ alert("No se pudo importar: " + (err?.message||err)); }
          };
          reader.readAsText(file);
        };

        return (
          <div className="container">
            <h1>PartiPay <span className="muted">/ comparte gastos sin dramas</span></h1>
            <p className="muted">Crea un evento, a√±ade participantes y deja que las mates hagan magia. Nada de "yo te invit√© al caf√©"‚Ä¶ salvo que el caf√© sea espectacular ‚òïÔ∏è.</p>

            {step !== "event" && (
              <div className="grid grid-2">
                <div className="card">
                  <div className="card-h"><h3>1) Crea tu Evento</h3><p className="muted small">Nombre y moneda.</p></div>
                  <div className="card-c grid">
                    <label>Nombre del evento
                      <input placeholder="Fin de semana en Trives" value={eventName} onChange={e=>setEventName(e.target.value)}/>
                    </label>
                    <label>Moneda
                      <select value={currency} onChange={e=>setCurrency(e.target.value)}>
                        {currencies.map(c=> <option key={c} value={c}>{c}</option>)}
                      </select>
                    </label>
                  </div>
                </div>

                {step === "setup" && (
                  <div className="card">
                    <div className="card-h"><h3>2) ¬øCu√°ntos participantes?</h3><p className="muted small">Prometo no juzgar si sois 2‚Ä¶ o 20.</p></div>
                    <div className="card-c grid">
                      <label>N√∫mero de participantes
                        <input type="number" min={1} max={20} value={numParticipants} onChange={e=>setNumParticipants(e.target.value)}/>
                      </label>
                      <button className="btn primary" onClick={handleSetupNext}>Continuar</button>
                    </div>
                  </div>
                )}

                {step === "participants" && (
                  <div className="card" style={{gridColumn:"1 / -1"}}>
                    <div className="card-h"><h3>2) Nombres de participantes</h3><p className="muted small">Pon nombres reales o alias √©picos.</p></div>
                    <div className="card-c grid grid-2">
                      {participantsDraft.map((name, idx)=> (
                        <label key={idx}>Participante #{idx+1}
                          <input value={name} onChange={e=> setParticipantsDraft(prev => prev.map((v,i)=> i===idx? e.target.value : v))}/>
                        </label>
                      ))}
                      <div className="row" style={{justifyContent:"flex-end", gridColumn:"1 / -1"}}>
                        <button className="btn" onClick={()=>setStep("setup")}>Volver</button>
                        <button className="btn primary" onClick={handleCreateEvent}>Crear Evento</button>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            )}

            {step === "event" && event && (
              <div className="grid">
                <div className="card">
                  <div className="card-c row" style={{justifyContent:"space-between", alignItems:"center"}}>
                    <div>
                      <div><strong>Evento:</strong> {event.name}</div>
                      <div className="muted small">Moneda: {event.currency} ‚Ä¢ Participantes: {event.participants.length} ‚Ä¢ Gastos: {event.expenses.length}</div>
                    </div>
                    <div className="chips">
                      <button className="btn primary" onClick={()=>setOpenExpense(true)}>A√±adir gasto</button>
                      <button className="btn" onClick={exportCSV}>Exportar CSV</button>
                      <button className="btn" onClick={exportJSON}>Exportar JSON</button>
                      <label className="btn">Importar
                        <input type="file" accept="application/json" style={{display:"none"}} onChange={e=>{ const f=e.target.files?.[0]; if(f) importJSON(f); }}/>
                      </label>
                      <button className="btn danger" onClick={hardReset}>Reset</button>
                    </div>
                  </div>
                </div>

                <div className="grid grid-2">
                  <div className="card">
                    <div className="card-h"><h3>Balances</h3><p className="muted small">Positivo = te deben. Negativo = debes.</p></div>
                    <div className="card-c">
                      <table>
                        <thead><tr><th>Participante</th><th className="right">Balance</th></tr></thead>
                        <tbody>
                          {event.participants.map(p=> (
                            <tr key={p.id}>
                              <td>{p.name}</td>
                              <td className={"right "+((balances[p.id]||0)>=0? "good":"bad")}>{fmt(balances[p.id]||0, event.currency)}</td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  </div>

                  <div className="card">
                    <div className="card-h"><h3>Liquidaciones sugeridas</h3><p className="muted small">M√≠nimo de pagos.</p></div>
                    <div className="card-c">
                      {settlements.length === 0 ? (
                        <p className="muted small">Todo en paz. Nadie le debe nada a nadie. ‚ú®</p>
                      ) : (
                        <ul>
                          {settlements.map((t, i)=>{
                            const from = event.participants.find(p=>p.id===t.from)?.name;
                            const to = event.participants.find(p=>p.id===t.to)?.name;
                            return <li key={i}><strong>{from}</strong> ‚Üí <strong>{to}</strong>: {fmt(t.amount, event.currency)}</li>
                          })}
                        </ul>
                      )}
                    </div>
                  </div>
                </div>

                <div className="card">
                  <div className="card-h"><h3>Gastos</h3><p className="muted small">Qui√©n pag√≥ qu√© y para qui√©n.</p></div>
                  <div className="card-c">
                    {event.expenses.length === 0 ? (
                      <p className="muted small">A√∫n no hay gastos. ¬°Estrena el bot√≥n "A√±adir gasto"! üí∏</p>
                    ) : (
                      <table>
                        <thead>
                          <tr>
                            <th>Fecha</th><th>Descripci√≥n</th><th>Pagadores</th><th className="right">Importe</th><th>Propina</th><th>Para</th>
                          </tr>
                        </thead>
                        <tbody>
                          {event.expenses.map(e=>{
                            const payerLabel = e.payerMode==='single'
                              ? event.participants.find(p=>p.id===e.payerId)?.name
                              : (e.payerSplits||[]).map(s=>`${event.participants.find(p=>p.id===s.payerId)?.name} (${fmt(s.amount, event.currency)})`).join(", ");
                            const tipLabel = e.tipAmount
                              ? `${fmt(e.tipAmount, event.currency)} ‚Äî ${event.participants.find(p=>p.id===e.tipPayerId)?.name}`
                              : "-";
                            const names = e.participantIds.map(pid=>event.participants.find(p=>p.id===pid)?.name).join(", ");
                            return (
                              <tr key={e.id}>
                                <td>{e.date}</td>
                                <td>{e.description}</td>
                                <td>{payerLabel}</td>
                                <td className="right">{fmt(e.amount, event.currency)}</td>
                                <td>{tipLabel}</td>
                                <td>{names}</td>
                              </tr>
                            );
                          })}
                        </tbody>
                      </table>
                    )}
                  </div>
                </div>

                {openExpense && (
                  <AddExpenseDialog
                    event={event}
                    setEvent={setEvent}
                    onClose={()=>setOpenExpense(false)}
                  />
                )}
              </div>
            )}
          </div>
        );
      }

      function AddExpenseDialog({ event, setEvent, onClose }){
        const [amount, setAmount] = useState("");
        const [tip, setTip] = useState("");
        const [desc, setDesc] = useState("");
        const [date, setDate] = useState(todayISO());
        const [payerMode, setPayerMode] = useState("single");
        const [payerId, setPayerId] = useState(event.participants[0]?.id || "");
        const [tipPayerId, setTipPayerId] = useState(event.participants[0]?.id || "");
        const [payerSplits, setPayerSplits] = useState([]); // [{payerId, amount}]
        const [selected, setSelected] = useState(event.participants.map(p=>p.id));
        const [note, setNote] = useState("");

        const base = parseFloat((amount||"0").replace(",", ".")) || 0;
        const tipVal = parseFloat((tip||"0").replace(",", ".")) || 0;
        const total = base + tipVal; 
        const perHead = selected.length>0 ? total/selected.length : 0;

        const addSplitRow = () => setPayerSplits(prev=>[...prev, { payerId: event.participants[0]?.id || "", amount: "" }]);
        const removeSplitRow = (idx) => setPayerSplits(prev=>prev.filter((_,i)=>i!==idx));
        const toggleSelectAll = (all) => setSelected(all ? event.participants.map(p=>p.id) : []);
        const toggleParticipant = (pid) => setSelected(prev => prev.includes(pid) ? prev.filter(x=>x!==pid) : [...prev, pid]);

        const submit = () => {
          if(!(base>0)) return alert("Pon un importe mayor que 0");
          if(!desc.trim()) return alert("Describe el gasto");
          if(selected.length===0) return alert("Selecciona al menos 1 participante");

          let payerIdValue = undefined;
          let payerSplitsValue = undefined;

          if(payerMode==='single'){
            payerIdValue = payerId;
          }else{
            const parsed = payerSplits.map(r=>({ payerId: r.payerId, amount: parseFloat((r.amount||"0").replace(",", ".")) || 0 }));
            const sum = parsed.reduce((a,b)=>a+b.amount,0);
            if(Math.abs(sum - base) > 0.01) return alert(`Las aportaciones (${sum.toFixed(2)}) deben sumar el importe base (${base.toFixed(2)})`);
            if(parsed.some(s=>!s.payerId || s.amount<=0)) return alert("Revisa filas: importes > 0 y pagador seleccionado.");
            payerSplitsValue = parsed;
          }

          const expense = {
            id: uid("e"),
            description: desc.trim(),
            amount: Math.round(base*100)/100,
            payerMode,
            payerId: payerIdValue,
            payerSplits: payerSplitsValue,
            tipAmount: Math.round(tipVal*100)/100 || undefined,
            tipPayerId: tipVal>0 ? tipPayerId : undefined,
            participantIds: [...selected],
            date,
            note: (note||"").trim() || undefined,
          };
          setEvent(prev => ({ ...prev, expenses: [...prev.expenses, expense] }));
          onClose();
        };

        return (
          <div className="overlay" onClick={(e)=>{ if(e.target===e.currentTarget) onClose(); }}>
            <div className="modal" role="dialog" aria-modal="true" aria-labelledby="new-expense-title" onClick={(e)=>e.stopPropagation()}>
              <div className="modal-header">
                <h3 id="new-expense-title" className="modal-title">Nuevo gasto</h3>
                <button className="btn" onClick={onClose} aria-label="Cerrar">Cerrar</button>
              </div>

              <div className="modal-body">
                <div className="grid-2-narrow">
                  <label>Importe ({event.currency})
                    <input inputMode="decimal" placeholder="0,00" value={amount} onChange={e=>setAmount(e.target.value)} />
                  </label>
                  <label>Propina ({event.currency})
                    <input inputMode="decimal" placeholder="0,00" value={tip} onChange={e=>setTip(e.target.value)} />
                  </label>
                  <label>Fecha
                    <input type="date" value={date} onChange={e=>setDate(e.target.value)} />
                  </label>
                  <label style={{gridColumn:"1 / -1"}}>Descripci√≥n
                    <input placeholder="Cena, peajes, caf√©s, entradas‚Ä¶" value={desc} onChange={e=>setDesc(e.target.value)} />
                  </label>
                </div>

                <div style={{marginTop:12}}>
                  <div className="row" style={{gap:16}}>
                    <label className="row"><input type="radio" checked={payerMode==='single'} onChange={()=>setPayerMode('single')} /> Una persona</label>
                    <label className="row"><input type="radio" checked={payerMode==='multi'} onChange={()=>setPayerMode('multi')} /> Varios (repartido)</label>
                  </div>

                  {payerMode==='single' ? (
                    <label style={{marginTop:8}}>Pag√≥
                      <select value={payerId} onChange={e=>setPayerId(e.target.value)}>
                        {event.participants.map(p=> <option key={p.id} value={p.id}>{p.name}</option>)}
                      </select>
                    </label>
                  ) : (
                    <div className="grid" style={{gap:8, marginTop:8}}>
                      <div className="row" style={{justifyContent:"space-between"}}>
                        <strong>Pagadores y aportes (deben sumar {fmt(parseFloat(amount||"0")||0, event.currency)})</strong>
                        <button className="btn" onClick={addSplitRow}>A√±adir pagador</button>
                      </div>
                      {payerSplits.length===0 && <p className="small muted">A√±ade filas con cada persona que puso dinero.</p>}
                      {payerSplits.map((row, idx)=> (
                        <div key={idx} className="row" style={{gap:8}}>
                          <select value={row.payerId} onChange={e=> setPayerSplits(prev=> prev.map((r,i)=> i===idx? {...r, payerId: e.target.value}: r))}>
                            {event.participants.map(p=> <option key={p.id} value={p.id}>{p.name}</option>)}
                          </select>
                          <input style={{width:160}} inputMode="decimal" placeholder="0,00" value={row.amount} onChange={e=> setPayerSplits(prev=> prev.map((r,i)=> i===idx? {...r, amount: e.target.value}: r))} />
                          <button className="btn danger" onClick={()=>removeSplitRow(idx)}>√ó</button>
                        </div>
                      ))}
                      <p className="small" style={{color: Math.abs((payerSplits.reduce((a,b)=>a+(parseFloat((b.amount||"0").replace(",", "."))||0),0)) - (parseFloat((amount||"0").replace(",", "."))||0)) < 0.01 ? '#065f46' : '#b91c1c'}}>
                        Suma actual: {
                          fmt(
                            payerSplits.reduce((a,b)=>a+(parseFloat((b.amount||"0").replace(",", "."))||0),0),
                            event.currency
                          )
                        }
                      </p>
                    </div>
                  )}
                </div>

                <div className="grid-2-narrow" style={{marginTop:12}}>
                  <label>¬øQui√©n paga la propina?
                    <select value={tipPayerId} onChange={e=>setTipPayerId(e.target.value)}>
                      {event.participants.map(p=> <option key={p.id} value={p.id}>{p.name}</option>)}
                    </select>
                  </label>
                  <label>Nota (opcional)
                    <input placeholder="Detalles, c√≥digos de recibo‚Ä¶" value={note} onChange={e=>setNote(e.target.value)} />
                  </label>
                </div>

                <div style={{marginTop:12}}>
                  <div className="row" style={{justifyContent:"space-between", marginBottom:8}}>
                    <strong>Aplica a ‚Äî {selected.length} personas ‚Üí {fmt(perHead||0, event.currency)} / cabeza</strong>
                    <div className="row">
                      <button className="btn" onClick={()=>setSelected(event.participants.map(p=>p.id))}>Todos</button>
                      <button className="btn" onClick={()=>setSelected([])}>Ninguno</button>
                      <button className="btn" onClick={()=>setSelected([payerId])}>Solo pagador</button>
                    </div>
                  </div>
                  <div className="chips">
                    {event.participants.map(p=> (
                      <label key={p.id} className="chip">
                        <input type="checkbox" checked={selected.includes(p.id)} onChange={()=>
                          setSelected(prev => prev.includes(p.id) ? prev.filter(x=>x!==p.id) : [...prev, p.id])
                        } /> {p.name}
                      </label>
                    ))}
                  </div>
                </div>
              </div>

              <div className="modal-footer">
                <button className="btn" onClick={onClose}>Cancelar</button>
                <button className="btn primary" onClick={submit}>Guardar</button>
              </div>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
